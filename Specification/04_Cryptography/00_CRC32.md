# CRC32 Specification

## Algorithm Parameters

The RAIDA protocol uses the standard CRC32 algorithm compatible with `zlib.crc32()`.

| Parameter | Value |
|-----------|-------|
| Polynomial | 0x04C11DB7 (reflected: 0xEDB88320) |
| Initial Value | 0xFFFFFFFF |
| Reflect Input | Yes (LSB first) |
| Reflect Output | Yes |
| Final XOR | 0xFFFFFFFF |
| Output Byte Order | Big-endian |

## Reference Implementation

```python
import zlib
import struct

def calculate_crc32(data: bytes) -> bytes:
    """
    Calculate CRC32 for challenge field.

    Args:
        data: Input bytes (typically 12 random bytes)

    Returns:
        4 bytes CRC32 in big-endian order
    """
    crc = zlib.crc32(data) & 0xFFFFFFFF
    return struct.pack('>I', crc)  # Big-endian (MSB first)
```

## Test Vectors

### Test Vector 1
```
Input:  b'Hello World!' (48 65 6C 6C 6F 20 57 6F 72 6C 64 21)
CRC32:  0x1C291CA3
Output: 1C 29 1C A3 (big-endian bytes)
```

### Test Vector 2
```
Input:  b'\x00' * 12 (12 zero bytes)
CRC32:  0xC622F71D
Output: C6 22 F7 1D
```

### Test Vector 3
```
Input:  b'\xFF' * 12 (12 0xFF bytes)
CRC32:  0x62E8B94B
Output: 62 E8 B9 4B
```

## Verification Code

```python
def verify_crc32():
    # Test Vector 1
    data = b'Hello World!'
    result = calculate_crc32(data)
    assert result == bytes.fromhex('1C291CA3'), f"Got {result.hex()}"

    # Test Vector 2
    data = b'\x00' * 12
    result = calculate_crc32(data)
    assert result == bytes.fromhex('C622F71D'), f"Got {result.hex()}"

    print("All CRC32 tests passed")

verify_crc32()
```

## Common Mistakes

### Wrong byte order
```python
# WRONG - Little-endian
crc_bytes = struct.pack('<I', crc)  # LE gives A3 1C 29 1C
```

### Wrong library
```python
# WRONG - Some libraries use different parameters
import binascii
crc = binascii.crc32(data)  # May differ from zlib
```

### Not masking to 32 bits
```python
# WRONG on some platforms
crc = zlib.crc32(data)  # May be signed on Python 2
# CORRECT
crc = zlib.crc32(data) & 0xFFFFFFFF
```

## Related

- See `01_Challenge_Construction.md` for `generate_challenge()` and `validate_challenge()` functions
- See `../02_Request_Headers/01_Header_32_Byte.md` for where CRC appears in protocol
